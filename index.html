<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>App Justi√ßa Restaurativa ‚Äî Web</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --primary: #22c55e;
        --primary-700: #15803d;
        --border: #1f2937;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
        background: linear-gradient(180deg, #0b1020, #0f172a);
        color: var(--text);
      }
      header {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        backdrop-filter: saturate(120%) blur(6px);
        background: rgba(15, 23, 42, 0.8);
      }
      header h1 { margin: 0; font-size: 18px; letter-spacing: 0.2px; }
      .container { max-width: 960px; margin: 0 auto; padding: 20px; }
      .tabs {
        display: flex; gap: 8px; margin: 16px 0 24px;
        border-bottom: 1px solid var(--border); padding-bottom: 8px;
      }
      .tab {
        padding: 8px 12px; border: 1px solid var(--border); border-bottom: none;
        border-radius: 8px 8px 0 0; cursor: pointer; color: var(--muted);
        background: #0b1222;
      }
      .tab.active { color: var(--text); background: #121a31; border-color: #263045; }
      .card {
        background: #0b1222; border: 1px solid #263045; border-radius: 12px;
        padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      }
      .row { display: flex; gap: 12px; flex-wrap: wrap; }
      .col { flex: 1 1 300px; }
      label { display: block; margin: 8px 0 6px; color: var(--muted); font-size: 14px; }
      input, textarea, select {
        width: 100%; padding: 10px 12px; border-radius: 8px;
        border: 1px solid #263045; background: #0f1a33; color: var(--text);
        outline: none;
      }
      textarea { min-height: 120px; }
      button {
        background: var(--primary); color: #04140c; border: none; padding: 10px 14px;
        border-radius: 10px; font-weight: 600; cursor: pointer;
      }
      button.secondary {
        background: transparent; color: var(--text); border: 1px solid #263045;
      }
      .meta { font-size: 12px; color: var(--muted); }
      .meter-wrap {
        height: 14px; background: #0f1a33; border: 1px solid #263045; border-radius: 10px;
        overflow: hidden; margin: 10px 0 8px;
      }
      .meter {
        height: 100%; background: linear-gradient(90deg,#22c55e,#4ade80);
        width: 0%;
        transition: width 300ms ease;
      }
      .plant-emoji { font-size: 42px; margin: 8px 0; }
      .list { margin-top: 10px; }
      .list-item {
        padding: 8px 10px; border: 1px dashed #263045; border-radius: 8px;
        margin-bottom: 8px; background: #0f1a33;
      }
      audio { width: 100%; margin-top: 12px; }
      .footer { margin-top: 18px; font-size: 12px; color: var(--muted); }
    </style>
  </head>
  <body>
    <header>
      <h1>App Complementar ‚Äî Justi√ßa Restaurativa (Web)</h1>
    </header>
    <div id="root" class="container"></div>

    <!-- React via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- App com corre√ß√£o de execu√ß√£o -->
    <script type="text/babel">
      const { useState, useEffect } = React;

      // Storage helpers
      const store = {
        get(key, fallback) {
          try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
          catch { return fallback; }
        },
        set(key, val) {
          try { localStorage.setItem(key, JSON.stringify(val)); } catch {}
        }
      };

      // Safe UUID
      const newId = () => {
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        return 'id-' + Math.random().toString(36).slice(2) + Date.now();
      };

      // Tabs
      function Tabs({ active, onChange }) {
        const items = [
          { key: "diario", label: "Di√°rio" },
          { key: "planta", label: "Planta" },
          { key: "escuta", label: "Escuta" },
        ];
        return (
          <div className="tabs">
            {items.map(it => (
              <div
                key={it.key}
                className={"tab " + (active === it.key ? "active" : "")}
                onClick={() => onChange(it.key)}
                role="button"
                aria-label={"Ir para " + it.label}
                tabIndex={0}
                onKeyDown={(e) => e.key === 'Enter' && onChange(it.key)}
              >
                {it.label}
              </div>
            ))}
          </div>
        );
      }

      // Diario Screen
      function DiarioScreen({ onSave }) {
        const [emotion, setEmotion] = useState("");
        const [intensity, setIntensity] = useState(5);
        const [note, setNote] = useState("");
        const [entries, setEntries] = useState(() => store.get("entries", []));

        const save = () => {
          if (!emotion.trim()) { alert("Digite uma emo√ß√£o."); return; }
          const entry = {
            id: newId(),
            date: new Date().toISOString(),
            emotion,
            intensity,
            note
          };
          const next = [entry, ...entries];
          setEntries(next);
          store.set("entries", next);
          setEmotion(""); setIntensity(5); setNote("");
          onSave?.();
          alert("Registro salvo!");
        };

        return (
          <div className="card">
            <h2>Di√°rio sensorial</h2>
            <p className="meta">Registre sua emo√ß√£o principal e uma nota breve. Salvar um registro concede √°gua para a planta.</p>
            <div className="row">
              <div className="col">
                <label>Emo√ß√£o principal</label>
                <input placeholder="ex.: serenidade, raiva, esperan√ßa" value={emotion} onChange={(e)=>setEmotion(e.target.value)} />
              </div>
              <div className="col">
                <label>Intensidade (1‚Äì10)</label>
                <input type="range" min="1" max="10" value={intensity} onChange={(e)=>setIntensity(Number(e.target.value))} />
                <div className="meta">Atual: {intensity}</div>
              </div>
            </div>
            <label>Notas</label>
            <textarea placeholder="O que aconteceu? O que voc√™ precisa agora?" value={note} onChange={(e)=>setNote(e.target.value)} />
            <div style={{ display: "flex", gap: 8, marginTop: 12 }}>
              <button onClick={save}>Salvar registro</button>
              <button className="secondary" onClick={() => { setEmotion(""); setIntensity(5); setNote(""); }}>Limpar</button>
            </div>

            <div className="list">
              <h3>Registros recentes</h3>
              {entries.length === 0 && <div className="meta">Nenhum registro ainda.</div>}
              {entries.map(e => (
                <div className="list-item" key={e.id}>
                  <strong>{new Date(e.date).toLocaleString()}</strong><br />
                  Emo√ß√£o: {e.emotion} ¬∑ Intensidade: {e.intensity}<br />
                  {e.note && <span className="meta">{e.note}</span>}
                </div>
              ))}
            </div>
          </div>
        );
      }

      // Planta Screen
      function PlantaScreen({ hydration, onWater, stage }) {
        const stageLabel = {
          seed: "Semente",
          sprout: "Broto",
          sapling: "Muda",
          tree: "√Årvore"
        }[stage];

        return (
          <div className="card">
            <h2>Planta virtual</h2>
            <p className="meta">Registre emo√ß√µes e conclua tarefas de escuta/empatia para regar sua planta.</p>
            <div className="plant-emoji">
              {stage === "seed" && "üå±"}
              {stage === "sprout" && "üåø"}
              {stage === "sapling" && "ü™¥"}
              {stage === "tree" && "üå≥"}
            </div>
            <div className="meta">Est√°gio: {stageLabel}</div>
            <div className="meter-wrap"><div className="meter" style={{ width: hydration + "%" }}></div></div>
            <div className="meta">Hidrata√ß√£o: {hydration}%</div>
            <div style={{ display: "flex", gap: 8, marginTop: 12 }}>
              <button onClick={onWater}>Regar planta</button>
              <button className="secondary" onClick={() => alert("Regras: cada registro/escuta concede 10% de hidrata√ß√£o.")}>Ver regras</button>
            </div>
            {hydration === 100 && <div className="meta" style={{ marginTop: 10 }}>Parab√©ns! Sua planta est√° totalmente crescida.</div>}
          </div>
        );
      }

      // Escuta Screen
      function EscutaScreen({ onCompleted }) {
        const [speed, setSpeed] = useState(1);
        const [completed, setCompleted] = useState(false);

        useEffect(() => {
          const audio = document.getElementById("demo-audio");
          if (audio) audio.playbackRate = speed;
        }, [speed]);

        const finish = () => {
          if (!completed) {
            setCompleted(true);
            onCompleted?.();
            alert("Sess√£o de escuta conclu√≠da. Voc√™ ganhou √°gua para a planta.");
          }
        };

        return (
          <div className="card">
            <h2>Escuta desacelerada</h2>
            <p className="meta">Ou√ßa o depoimento em velocidade reduzida e reflita: ‚ÄúO que essa pessoa precisa?‚Äù</p>
            <div className="row">
              <div className="col">
                <label>Velocidade</label>
                <select value={String(speed)} onChange={(e)=>setSpeed(Number(e.target.value))}>
                  <option value="0.5">0.5x (lenta)</option>
                  <option value="0.75">0.75x</option>
                  <option value="1">1x (normal)</option>
                  <option value="1.25">1.25x</option>
                </select>
              </div>
              <div className="col">
                <label>A√ß√£o</label>
                <button onClick={finish} disabled={completed} style={{ background: completed ? "#0f1a33" : undefined, color: completed ? "#9ca3af" : undefined }}>
                  Marcar como conclu√≠da
                </button>
              </div>
            </div>
<audio id="demo-audio" controls preload="metadata">
  <source 
    src="https://ia803105.us.archive.org/24/items/gravando-4-vocals/Gravando%20%284%29%20%5Bvocals%5D.mp3" 
    type="audio/mpeg" 
  />
  Seu navegador n√£o suporta o elemento de √°udio.
</audio>
           
           <div className="footer">Dica: use 0.75x para compreender pausas e nuances.</div>
          </div>
        );
      }

      // App Root
      function App() {
        const [tab, setTab] = useState(() => store.get("tab", "diario"));
        const [hydration, setHydration] = useState(() => store.get("hydration", 0));

        const stage = hydration < 25 ? "seed" :
                      hydration < 50 ? "sprout" :
                      hydration < 90 ? "sapling" : "tree";

        useEffect(() => { store.set("tab", tab); }, [tab]);
        useEffect(() => { store.set("hydration", hydration); }, [hydration]);

        const awardWater = (amount = 10) => {
          setHydration(h => Math.min(h + amount, 100));
        };

        return (
          <>
            <Tabs active={tab} onChange={setTab} />
            {tab === "diario" && <DiarioScreen onSave={() => awardWater(10)} />}
            {tab === "planta" && <PlantaScreen hydration={hydration} stage={stage} onWater={() => awardWater(10)} />}
            {tab === "escuta" && <EscutaScreen onCompleted={() => awardWater(10)} />}
          </>
        );
      }

      // ‚úÖ Corre√ß√£o: adia a renderiza√ß√£o at√© que o Babel processe o JSX
      window.initApp = () => {
        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
      };
    </script>

    <!-- Garante execu√ß√£o ap√≥s transpila√ß√£o -->
    <script>
      // Executa ap√≥s o DOM e scripts serem carregados
      window.addEventListener('load', () => {
        // @babel/standalone transpila scripts type="text/babel" durante o load
        // Aguardamos um tick para garantir que `initApp` esteja definida
        setTimeout(() => {
          if (typeof window.initApp === 'function') {
            window.initApp();
          } else {
            console.error("‚ùå Falha: initApp n√£o definida. Verifique erros de transpila√ß√£o no console.");
            // Fallback visual
            document.getElementById("root").innerHTML = `
              <div class="card" style="text-align:center;color:#ef4444">
                <h3>‚ùå Erro ao carregar o app</h3>
                <p>Verifique se o script Babel foi carregado corretamente.</p>
                <p>Abra o console (F12) para detalhes.</p>
              </div>
            `;
          }
        }, 100);
      });
    </script>
  </body>
</html>
  
